var gH=function(){var e={},t=jQuery,r="hide";return{gallery:function(r,a,n,s){var l;(l=t("#"+r+"pad"))&&(e[r]={insertOnly:s,builderOn:s?!0:!1,imageUrl:a,cacheUrl:n,selected:{},currentImages:null,imageIndex:null,selectOrder:[],changed:{},currentOffset:0,currentLimit:0,showingCurrent:!1,idsOnly:!1,pad:l,folders:t("#"+r+"folders"),recurse:t("#"+r+"recurse"),start:t("#"+r+"start"),end:t("#"+r+"end"),name:t("#"+r+"name"),title:t("#"+r+"title"),comment:t("#"+r+"comment"),tags:t("#"+r+"tags"),filter:t("#"+r+"filter"),filterLabel:t("#"+r+"filterLabel"),builder:t("#"+r+"builder"),builderLabel:t("#"+r+"builderLabel"),limit:t("#"+r+"limit"),shortcode:t("#"+r+"shortcode"),selectedLabel:t("#"+r+"selectedLabel"),sctype:t("#"+r+"sctype"),pages:t("#"+r+"pages")},isNaN(e[r].currentLimit=parseInt(e[r].limit.val()))&&(e[r].currentLimit=50,e[r].limit.val(50)),e[r].folders.multiselect({noneSelectedText:"Select folders",selectedText:"# folders selected"}),e[r].start.datetimepicker({timeFormat:"HH:mm",dateFormat:"yy-mm-dd",stepMinute:10,controlType:"select",onClose:function(){if(""!=e[r].end.val()){var t=e[r].start.datetimepicker("getDate"),a=e[r].end.datetimepicker("getDate");t>a&&e[r].end.datetimepicker("setDate",t)}},onSelect:function(){e[r].end.datetimepicker("option","minDate",e[r].start.datetimepicker("getDate"))}}),e[r].end.datetimepicker({timeFormat:"HH:mm",dateFormat:"yy-mm-dd",stepMinute:10,controlType:"select",onClose:function(){if(""!=e[r].start.val()){var t=e[r].start.datetimepicker("getDate"),a=e[r].end.datetimepicker("getDate");t>a&&e[r].start.datetimepicker("setDate",a)}},onSelect:function(){e[r].start.datetimepicker("option","maxDate",e[r].end.datetimepicker("getDate"))}})),this.compileShortcode(r)},toggle:function(t,a,n,s,l){return s||(s="Show"),l||(l="Hide"),e[t]&&e[t][a]?e[t][a].hasClass(r)?(e[t][a].removeClass(r),e[t][a+"Label"].html(l+" "+n),!0):(e[t][a].addClass(r),e[t][a+"Label"].html(s+" "+n),!1):void 0},thumbnail:function(e){return e.replace(/\//g,"_")},filter:function(r){e[r].query||(e[r].query={folders:[],recurse:!1,start:"",end:"",name:"",title:"",comment:"",tags:""});var a,n,s,l=!1;for(a in e[r].query)if("folders"==a){if(n=e[r][a].val(),null==e[r].query[a]&&null==n)continue;(null==e[r].query[a]||null==n||e[r].query[a].length!=n.length)&&(e[r].query[a]=n,l=!0);for(s in e[r].query[a])e[r].query[a][s]!=n[s]&&(e[r].query[a]=n,l=!0)}else"checkbox"==e[r][a].prop("type")?(n=e[r][a].prop("checked"),(e[r].query[a]?n:!n)&&(e[r].query[a]=n,l=!0)):e[r].query[a]!=(n=e[r][a].val())&&(e[r].query[a]=n,l=!0);l&&t.post(ajaxurl+"?action=gh_gallery",e[r].query,this.returnFunction(this.receiveData,r))},toggleBuilder:function(t){e[t].insertOnly?this.toggle(t,"builder","shortcode"):(e[t].builderOn=this.toggle(t,"builder","shortcode builder","Enable","Disable"))?e[t].pad.addClass("builderOn"):e[t].pad.removeClass("builderOn")},receiveData:function(t,r){e[t].imageData=r,this.setCurrentImages(t,e[t].imageData),this.printImages(t,0),e[t].idsOnly=!1,this.compileShortcode(t)},repage:function(t){var r=parseInt(e[t].limit.val());isNaN(r)&&(e[t].limit.val("50"),r=50),e[t].currentLimit=r,e[t].currentImages&&(e[t].currentOffset=r?Math.floor(e[t].currentOffset/r)*r:0,this.printImages(t,e[t].currentOffset))},changePage:function(t){var r,a=Math.floor(e[t].currentOffset/e[t].currentLimit)+1,n=Math.floor(e[t].currentImages.length/e[t].currentLimit)+1;isNaN(r=parseInt(e[t].pageNumber.val()))?(r=a,e[t].pageNumber.val(r)):r>n?(r=n,e[t].pageNumber.val(r)):1>r&&(r=1,e[t].pageNumber.val(r)),r!=a&&(r=(r-1)*e[t].currentLimit,this.printImages(t,r))},printImages:function(r,a){if(isNaN(a=parseInt(a))&&(a=0),e[r].currentImages){e[r].currentOffset=a,e[r].pad.html("");var n=Math.min(a+e[r].currentLimit,e[r].currentImages.length);a=Math.min(a,e[r].currentImages.length);var s;for(s=a;n>s;s++){var l,i,c,d=(e[r].currentImages[s].div=t(document.createElement("div"))).addClass("galleryThumb");d.append(c=t(document.createElement("a"))),c.attr("href",e[r].imageUrl+"/"+e[r].currentImages[s].file),c.attr("data-lightbox","thumbs"),c.attr("data-title","ID: "+e[r].currentImages[s].id+". Title: "+e[r].currentImages[s].title+". Comment: "+e[r].currentImages[s].comment),c.append(l=t(document.createElement("img"))),l.attr("src",e[r].cacheUrl+"/"+this.thumbnail(e[r].currentImages[s].file)),d.append(l=t(document.createElement("div"))),l.click(this.returnFunction(this.exclude,r,s)),l.addClass("exclude"),l.attr("title","Exclude from galleries by default"),d.append(l=t(document.createElement("div"))),l.addClass("select"),l.click(this.returnFunction(this.select,r,s)),l.attr("title","Include in selection"),d.append(l=t(document.createElement("div"))),l.addClass("orderer"),l.append(i=t(document.createElement("div"))),i.addClass("dashicons dashicons-arrow-left-alt"),i.click(this.returnFunction(this.order,r,s,-1)),l.append(e[r].currentImages[s].order=i=t(document.createElement("div"))),i.addClass("order"),l.append(i=t(document.createElement("div"))),i.addClass("dashicons dashicons-arrow-right-alt"),i.click(this.returnFunction(this.order,r,s,1)),!e[r].currentImages[s].exclude||"1"!==e[r].currentImages[s].exclude&&e[r].currentImages[s].exclude!==!0||d.addClass("excluded"),e[r].selected[e[r].currentImages[s].id]&&(d.addClass("selected"),e[r].currentImages[s].order.html(e[r].selectOrder.indexOf(e[r].currentImages[s].id)+1)),e[r].pad.append(d)}e[r].pages.html(""),e[r].pages.append(l=t(document.createElement("span"))),l.addClass("displaying-num"),l.html(e[r].currentImages.length+" items"),e[r].pages.append(l=t(document.createElement("a"))),0!==a?l.click(this.returnFunction(this.printImages,r,0)):l.addClass("disabled"),l.html("&laquo;"),l.addClass("first-page"),e[r].pages.append(l=t(document.createElement("a"))),0!==a?((s=a-n)<0&&(s=0),l.click(this.returnFunction(this.printImages,r,s))):l.addClass("disabled"),l.html("&lsaquo;"),l.addClass("prev-page"),e[r].pages.append(l=e[r].pageNumber=t(document.createElement("input"))),l.attr("type","number"),l.addClass("current-page"),l.attr("title","Current Page"),l.val(Math.ceil(a/e[r].currentLimit)+1),l.change(this.returnFunction(this.changePage,r)),e[r].pages.append(document.createTextNode(" of "));var u=Math.floor(e[r].currentImages.length/e[r].currentLimit),m=u*e[r].currentLimit;e[r].pages.append(l=t(document.createElement("span"))),l.addClass("total-pages"),l.html(u+1),e[r].pages.append(l=t(document.createElement("a"))),a!==m?((s=a+e[r].currentLimit)>m&&(s=m),l.click(this.returnFunction(this.printImages,r,s))):l.addClass("disabled"),l.html("&rsaquo;"),l.addClass("next-page"),e[r].pages.append(l=t(document.createElement("a"))),a!==m?l.click(this.returnFunction(this.printImages,r,m)):l.addClass("disabled"),l.html("&raquo;"),l.addClass("last-page")}},setCurrentImages:function(t,r){var a;e[t].currentImages=r,e[t].imageIndex={};for(a in e[t].currentImages)e[t].currentImages[a].id&&(e[t].imageIndex[e[t].currentImages[a].id]=a)},toggleSelected:function(t){var r;if(e[t].showingCurrent!==!1){for(r in e[t].selected)e[t].selected[r].selected||delete e[t].selected[r];e[t].currentOffset=e[t].showingCurrent,this.setCurrentImages(t,e[t].imageData),e[t].selectedLabel.html("Show currently selected images"),e[t].showingCurrent=!1,this.printImages(t,e[t].currentOffset)}else{e[t].currentImages=[],e[t].imageIndex={};var r;for(r in e[t].selectOrder)e[t].currentImages[r]=e[t].selected[e[t].selectOrder[r]],e[t].imageIndex[e[t].selectOrder[r]]=r;e[t].showingCurrent=e[t].currentOffset,e[t].currentOffset=0,e[t].selectedLabel.html("Show filtered images"),this.printImages(t,e[t].currentOffset)}},returnFunction:function(e){var t=Array.prototype.slice.call(arguments);t.shift();var r=this;return function(){t=t.concat(Array.prototype.slice.call(arguments)),e.apply(r,t)}},order:function(t,r,a){if((-1===a||1===a)&&e[t].currentImages[r]){var n=e[t].currentImages[r].id,s=e[t].selectOrder.indexOf(n);if(-1===a&&0===s||1===a&&s===e[t].selectOrder.length-1)return;var l=e[t].selectOrder[s+a];e[t].selectOrder[s+a]=e[t].selectOrder[s],e[t].selectOrder[s]=l,e[t].imageIndex[l]&&e[t].currentImages[e[t].imageIndex[l]]&&e[t].currentImages[e[t].imageIndex[l]].order.html(s+1),e[t].currentImages[r].order.html(s+a+1),this.compileShortcode(t)}},compileShortcode:function(t){var r="["+e[t].sctype.val(),a=[];if(e[t].selectOrder.length&&(a=e[t].selectOrder.slice(0)),!e[t].idsOnly){var n=e[t].folders.val();n&&a.push("folder="+n.join("|"));var s=e[t].start.val(),l=e[t].end.val();(s||l)&&a.push("taken="+(s?s:"")+"|"+(l?l:""));var i,c=["name","title","comment","tags"];for(p in c)(i=e[t][c[p]].val())&&a.push(c[p]+"="+i)}r+=' id="'+a.join(",")+'"',r+="]",e[t].shortcode.html(r)},save:function(r){var a,n,s={},l=!1;for(a in e[r].changed){console.log("Change "+a);for(n in e[r].changed[a])console.log("Change value "+n),e[r].changed[a][n]["new"]!==e[r].changed[a][n].old&&(s[a]||(console.log("Setting new value "+e[r].changed[a][n]["new"]),s[a]={}),s[a][n]=e[r].changed[a][n]["new"],l=!0)}l&&t.post(ajaxurl+"?action=gh_save",{saveData:s},this.returnFunction(this.confirmSave,r))},confirmSave:function(t,r){alert(r),"Error"!==r.substring(0,"Error".length)&&(e[t].changed={})},select:function(t,r){if(e[t].currentImages[r]){var a,n=e[t].currentImages[r].id;e[t].selected[n]&&1==e[t].selected[n].selected?(-1!==(a=e[t].selectOrder.indexOf(n))&&e[t].selectOrder.splice(a,1),e[t].currentImages[r].div.removeClass("selected"),e[t].showingCurrent!==!1?e[t].selected[n].selected=!1:delete e[t].selected[n],this.reOrder(t)):(e[t].selected[n]=e[t].currentImages[r],e[t].selected[n].selected=!0,e[t].selectOrder.push(n),e[t].currentImages[r].order.html(e[t].selectOrder.length),e[t].currentImages[r].div.addClass("selected"),e[t].idsOnly=!0),this.compileShortcode(t)}},reOrder:function(t){var r,a;for(r in e[t].selectOrder)a=e[t].selectOrder[r],e[t].imageIndex[a]&&e[t].currentImages[e[t].imageIndex[a]].order.html(1*r+1)},exclude:function(t,r){if(e[t].imageData[r]){var a=e[t].imageData[r].id;e[t].changed[a]||(e[t].changed[a]={}),e[t].changed[a].exclude||(e[t].changed[a].exclude={old:e[t].imageData[r].exclude}),e[t].changed[a].exclude["new"]?(e[t].changed[a].exclude["new"]=!1,e[t].imageData[r].div.removeClass("excluded")):(e[t].changed[a].exclude["new"]=!0,e[t].imageData[r].div.addClass("excluded"))}}}}();
