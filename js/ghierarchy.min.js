!function(e){function t(t,n){if(this.objects={},this.options=t&&r[t]?r[t]:o,e("body").append(this.objects.backing=e('<div class="fBacking"></div>').append(e("<div></div>").append(this.objects.box=e("<div></div>").append(this.objects.div=e("<div></div>"))))),this.options.close&&this.objects.box.prepend(e('<div class="close"></div>').click(this.close.bind(this))),this.options.backgroundClose&&this.objects.backing.click(this.close.bind(this)),this.options.scroll&&t&&(this.current=null,d[t])){for(var a=0;a<d[t].length;){if(d[t][a].is(n)){this.current=a;break}a++}null==this.current&&(this.current=d[t].length,d[t].push(n)),this.objects.box.append(this.objects.left=e('<div class="left"></div>').click(this.scroll.bind(this,t,-1,null))).append(this.objects.right=e('<div class="right"></div>').click(this.scroll.bind(this,t,1,null))),this.options.autoscroll&&(this.objects.box.append(this.objects.autoControl=e('<div class="autoscroll">Pause</div>').click(pause.bind(this,this.objects))),this.objects.autoscroll=setTimeout(i.bind(this,this.objects,1),this.options.autoscroll))}s.call(this,n)}function i(){}function s(e){var t=this.options.default;this.options.generators[t]&&this.options.generators[t](e,this.objects)}function n(i,s,n){if(n){if(n.defaultPrevented)return;n.preventDefault()}if(!s){if(!e(this))return!1;s=e(this)}return new t(i,s)}function a(){}function l(t,i,s){if(t&&t instanceof Object&&i){var a;a=r[i]?r[i]:o,r[i]=e.extend({},a,t)}s&&s.each(function(){var t;t=e(this).attr("data-group"),!t&&i&&(t=i),d[t]||(d[t]=[]),d[t].push(e(this)),e(this).click(n.bind(this,t,e(this)))})}var d={},r={},o={generators:{image:a.bind(this)},"default":"image",close:!0,backgroundClose:!0,ignorePrevented:!0,scroll:!1,autoscroll:0};t.prototype={close:function(t){if(t){if(t.target!==t.currentTarget&&e.contains(this.objects.box.get(0),t.target))return;t.preventDefault()}this.objects.backing.remove(),delete this},scroll:function(e,t,i,n){if(n&&n.preventDefault&&n.preventDefault(),d[e]){var a=Math.max(0,Math.min(this.current+t,d[e].length-1));a!=this.current&&(this.current=a,this.objects.div.html(""),s.call(this,d[e][this.current]))}},pause:function(){}},e.fn.extend({viewer:function(t,i){return l(t,i,e(this)),e(this)}}),e.extend({viewer:{open:function(){},option:function(t,i,s){if(!(i instanceof Object)){var n;return t?(r[t]||(r[t]=e.extend({},o)),n=r[t]):n=o,void 0!==s?(n[i]=s,s):n[i]}t?r[t]=e.extend({},r[t]?r[t]:o,i):o=e.extend({},o,i),console.log(r)},clearGroup:function(e){d[e]&&delete d[e]}}})}(jQuery),gH=function(e){function t(e,t,i,s){if(console.log("addUploadedFile called"),C[e]){var n=JSON.parse(s.response);n.error,n.files&&(console.log(n.files),C[e].browser.displayFiles(n.files,!0))}}function i(e,t){return C[e]?(t.preventDefault(),C[e].dirId?!0:(t.stopImmediatePropagation(),alert("Please choose a directory to upload the files into"),!1)):void 0}function s(e){C[e]&&setTimeout(n.bind(this,e),2e3)}function n(e){C[e].uploader.destroy(),a(e)}function a(n){C[n].obj.pluploadQueue(C[n].options);var a=C[n].obj.pluploadQueue();C[n].uploader=a;var l=C[n].obj.find("a.plupload_start");l.click(i.bind(this,n));var d=e._data(l[0],"events").click;2==d.length&&d.unshift(d.pop()),a.bind("FileUploaded",t.bind(this,n)),a.bind("UploadComplete",s.bind(this,n)),C[n].dirId&&w.setUploadDir(n,{id:C[n].dirId})}function l(e){e.startTime?(x.status.html("<b>Current scan status: </b>"),x.scanBtn.addClass("disabled"),x.fullScanBtn.addClass("disabled")):(x.status.html("<b>Previous scan's last status: </b>"),x.scanBtn.removeClass("disabled"),x.fullScanBtn.removeClass("disabled")),e.status?(x.status.append(e.status),e.time&&x.status.append(" ("+e.time+")")):x.status.append("None")}function d(){r("status")}function r(t,i){i||(i={}),i.a=t,"status"!==t&&x.status.html("Starting scan... If this message doesn't change you may need to refresh the page."),e.post(ajaxurl+"?action=gh_scan",i,o)}function o(e){l(e),e.startTime&&setTimeout(d,1e4)}function c(t,i,s){i.append(e('<a href="'+g+"/"+s.path+'" target="_blank"><img src="'+this.thumbnail(s.path)+'"></a>').viewer(null,"gHBrowser").data("imageData",s))}function h(e,t){var i=new k(t.div,e.data("imageData"),{fullImage:!0});i.img.load(function(){u(t,i),window.addEventListener("resize",u.bind(this,t,i))}.bind(this))}function u(e,t){var i=t.img.prop("naturalWidth"),s=t.img.prop("naturalHeight"),n=window.innerWidth-40,a=window.innerHeight-90,l=n-(e.div.innerWidth()-t.img.innerWidth()),d=a-(e.div.innerHeight()-t.img.innerHeight());l>=i&&d>=s?(t.img.height(s),t.img.width(i)):l/i>d/s?(t.img.height(d),t.img.width(i/s*d)):(t.img.height(s/i*l),t.img.width(l))}function m(e,t){y[e].selectOrder=t,y[e].idsOnly=t.length?!0:!1,this.redisplayShortcode(e)}function f(e,t,i,s){if(y[e].saveButton.hasClass("disabled")&&y[e].saveButton.removeClass("disabled"),y[e].changed[t]||(y[e].changed[t]={}),!y[e].changed[t].exclude){var n=parseInt(s.exclude);y[e].changed[t].exclude={old:n}}y[e].changed[t].exclude.new=i?1:0,s.exclude=i?"1":"0"}var g,v,b,y={},x={},C={},e=jQuery,O="hide",k=function(){function t(t,i){var s,n=e("<tr></tr>");if(t&&n.append("<th>"+t+"</th>"),n.append(s=e("<td"+(t?"":' colspan="2"')+"></td>")),i.constructor===Array){var a;for(a in i)s.append(i[a])}else s.append(i);return n}function i(e,t){if(t instanceof Object){this.status.html(t.error?t.error:t.msg);var i=this;setTimeout(function(){e?(i.div.remove(),delete i):i.status.html("")},3e3)}}var s=function(t,i,s){this.obj=t,this.file=i,this.options=e.extend({editable:!0,fullImage:!1,showFileTitle:!0},s),this.draw()};return s.prototype={draw:function(){this.parts={};var i,s;this.obj.append(i=e("<div></div>")),this.div=i,i.addClass("gHEditor"),this.options.showFileTitle&&i.append("<h5>"+this.file.file+"</h5>"),i.append(s=e("<div></div>")),s.append(this.img=e('<img src="'+(this.options.fullImage?w.full(this.file.path):w.thumbnail(this.file.path))+'">')),i.append(this.details=e("<table></table>")),this.details.append(t("Image Dimensions:",this.file.width+"x"+this.file.height+"px")),this.file.taken&&this.details.append(t("Taken:",this.file.taken)),this.details.append(t("Title:",this.title=e('<input type="text" value="'+(this.file.title?this.file.title:"")+'">'))),this.details.append(t("Comment:",this.comment=e("<textarea>"+(this.file.comment?this.file.comment:"")+"</textarea>"))),this.details.append(t("Tags (comma-separated):",this.tags=e('<input type="text" value="'+(this.file.tags?this.file.tags:"")+'">'))),this.details.append(t("Exclude by Default:",this.exclude=e('<input type="checkbox"'+(this.file.exclude&&"1"==this.file.exclude?" checked":"")+">"))),this.details.append(t(null,[this.saveLink=e("<a>Save</a>").click(this.save.bind(this)),this.removeLink=e("<a>Remove</a>").click(this.remove.bind(this)),this.delLink=e("<a>Delete</a>").click(this.delete.bind(this)),this.status=e("<span></span>")]))},save:function(){var t={};t[this.file.id]={id:this.file.id,title:this.title.val(),comment:this.comment.val(),tags:this.tags.val().replace(/ *, */,","),exclude:this.exclude.attr("checked")?1:0},e.post(ajaxurl+"?action=gh_save",{a:"save",data:t},i.bind(this,!1)),this.status.html("Saving...")},remove:function(){confirm("Image will be removed from the gallery, but not deleted from the server. Continue?")&&(e.post(ajaxurl+"?action=gh_save",{a:"remove",id:this.file.id},i.bind(this,!0)),this.status.html("Removing..."))},"delete":function(){confirm("Image will be removed from the gallery and deleted from the server. Continue?")&&(e.post(ajaxurl+"?action=gh_save",{a:"delete",id:this.file.id},i.bind(this,!0)),this.status.html("Deleting..."))}},s}(),D=function(e){function t(){this.options.limit!==s.call(this)&&n.call(this)}function i(e,t){var t,i=s.call(this),a=Math.floor(this.currentOffset/i)+1,l=Math.floor(m(this.currentFiles)/i)+1;e?t=Math.max(1,a+e):-1===t&&(t=l),t||isNaN(t=parseInt(this.doms.pageNumber.val()))&&(t=a,this.doms.pageNumber.val(t)),t=Math.max(1,Math.min(t,l)),this.doms.pageNumber.val(t),t!=a&&(t=(t-1)*i,n.call(this,t))}function s(e){if(void 0===this.doms.limit)return null;if(void 0===e||isNaN(e)){if(e=parseInt(this.doms.limit.val()),isNaN(e))return this.doms.limit.val(this.options.limit),this.options.limit}else this.doms.limit.val(e);return e}function n(e){if(this.currentFiles){null!==e&&void 0!==e&&(this.currentOffset=Math.max(0,Math.min(e,m(this.currentFiles)))),this.doms.pad.html(""),this.fileDoms={},this.shownFiles={};var t=s.call(this),i=Math.min(this.currentOffset+t,m(this.currentFiles)),n=Math.floor(m(this.currentFiles)/t),l=n*t;this.doms.displaying.html(m(this.currentFiles)+(m(this.currentFiles)>1?" items":" item")),this.currentOffset?(this.doms.firstPage.removeClass("disabled"),this.doms.prevPage.removeClass("disabled")):(this.doms.firstPage.addClass("disabled"),this.doms.prevPage.addClass("disabled")),this.doms.pageNumber.val(Math.ceil(this.currentOffset/t)+1),this.doms.totalPages.html(n+1),this.currentOffset!==l?(this.doms.nextPage.removeClass("disabled"),this.doms.lastPage.removeClass("disabled")):(this.doms.nextPage.addClass("disabled"),this.doms.lastPage.addClass("disabled")),a.call(this,this.doms.pad,this.currentFiles,this.currentOffset,i)}}function a(t,i,s,n,l){var o;l||(l=0);for(o in i)if(void 0===i[o].type&&(i[o].type=this.options.defaultType),void 0!==i[o].files?(l>=s&&(this.fileDoms[o]={},t.prepend(e('<div class="folder"></div>').append("<div>"+i[o].name+"</div>").append(this.fileDoms[o].div=e("<div></div>"))),i[o].files&&a(this.fileDoms[o].div,i[o].files,s,n,l)),l++):this.options.generators[i[o].type]&&(l>=s&&(this.fileDoms[o]={},this.shownFiles[o]=i[o],t.append(this.fileDoms[o].div=e('<div class="file"></div>')),this.options.selection&&(this.fileDoms[o].div.append(e("<div"+(this.options.selectionClass?' class="'+this.options.selectionClass+'"':"")+">").data(i[o]).click(d.bind(this,o,i[o]))),this.selected[o]&&this.fileDoms[o].div.addClass(this.options.selectedClass),this.options.orderedSelection&&(this.fileDoms[o].div.append(e("<div"+(this.options.orderClass?' class="'+this.options.orderClass+'"':"")+">").data(i[o]).append(e('<div class="up"></div>').click(c.bind(this,o,-1))).append(this.fileDoms[o].order=e('<div class="order"></div>').click(h.bind(this,o))).append(e('<div class="down"></div>').click(c.bind(this,o,1)))),this.selected[o]&&this.fileDoms[o].order.html(this.selectOrder.indexOf(o)+1))),this.options.exclusion&&(this.fileDoms[o].div.append(e("<div"+(this.options.exclusionClass?' class="'+this.options.exclusionClass+'"':"")+">").data(i[o]).click(r.bind(this,o,i[o],void 0))),"1"==i[o].exclude&&this.fileDoms[o].div.addClass(this.options.excludedClass),i[o].excluded&&t.addClass(this.options.excludedClass)),this.options.generators[i[o].type](this.fileDoms[o].div,i[o])),l++),l>=n)return l;return l}function l(){var e,t;for(e in this.selectOrder)t=this.selectOrder[e],this.fileDoms[t]&&this.fileDoms[t].order.html(1*e+1)}function d(e,t){var i;this.selected[e]?(-1!==(i=this.selectOrder.indexOf(e))&&this.selectOrder.splice(i,1),this.fileDoms[e].div.removeClass(this.options.selectedClass),this.showingCurrent!==!1?this.fileDoms[e].selected=!1:delete this.selected[e],l.call(this)):(this.selected[e]=t,this.selectOrder.push(e),this.fileDoms[e].order.html(this.selectOrder.length),this.fileDoms[e].div.addClass(this.options.selectedClass),this.fileDoms[e].selected=!0),this.options.selection&&this.options.selection.call&&this.options.selection(this.selectOrder,this.selected)}function r(e,t,i){i=void 0===i?!this.fileDoms[e].div.hasClass(this.options.excludedClass):i,this.fileDoms[e]&&(i?this.fileDoms[e].div.hasClass(this.options.excludedClass)||this.fileDoms[e].div.addClass(this.options.excludedClass):this.fileDoms[e].div.hasClass(this.options.excludedClass)&&this.fileDoms[e].div.removeClass(this.options.excludedClass)),this.options.exclusion(e,i,t)}function o(e){var t;for(t in this.selected)e.call(this,t,this.selected[t],e)}function c(e,t){var i=this.selectOrder.indexOf(e),s=Math.max(0,Math.min(i+t,this.selectOrder.length-1));-1!=i&&s!=i&&(this.selectOrder.splice(i,1),this.selectOrder.splice(s,0,e),l.call(this),this.options.selection&&this.options.selection.call&&this.options.selection(this.selectOrder,this.selected))}function h(e){var t;if(void 0!==(t=prompt("Enter a new position for the file"))){t=Math.max(0,Math.min(t-1,this.selectOrder.length-1));var i=this.selectOrder.indexOf(e);if(-1==i||t==i)return;this.selectOrder.splice(i,1),this.selectOrder.splice(t,0,e),l.call(this)}}function p(e){var t;if(this.showingCurrent!==!1){for(t in this.selected)-1===this.selectOrder.indexOf(t)&&delete this.selected[t];this.currentFiles=this.displayFiles,this.currentOffset=this.showingCurrent,this.doms.showSelected.html("Show selected"),this.showingCurrent=!1}else{this.displayFiles=this.currentFiles,this.currentFiles={};var t;for(t in this.selectOrder)this.currentFiles[this.selectOrder[t]]=this.selected[this.selectOrder[t]];this.showingCurrent=this.currentOffset,this.currentOffset=0,this.doms.showSelected.html("Hide Selected")}e||n.call(this)}function u(e,t){if(!this.currentFiles)return void(this.currentFiles=e);t||(t=this.currentFiles);var i;for(i in e)t[i]?(t[i].type!=e[i].type,e[i].files&&(t[i].files?u(e[i].files,t[i].files):t[i].files=e[i].files)):t[i]=e[i]}function m(e){return e?e instanceof Array?e.length:e instanceof Object?Object.keys(e).length:void 0:null}function f(e,t){var i,s,n;switch(n=t?this.shownFiles:this.currentFiles,e){case 1:for(s in n)this.selected[s]||(this.selected[s]=n[s],this.selectOrder.push(s),this.fileDoms[s]&&this.fileDoms[s].div.addClass(this.options.selectedClass));break;case 0:for(s in n)-1!==(i=this.selectOrder.indexOf(s))&&(this.selectOrder.splice(i,1),delete this.selected[s],this.fileDoms[s]&&this.fileDoms[s].div.removeClass(this.options.selectedClass));break;case-1:for(s in n)-1!==(i=this.selectOrder.indexOf(s))?(this.selectOrder.splice(i,1),delete this.selected[s],this.fileDoms[s]&&this.fileDoms[s].div.removeClass(this.options.selectedClass)):(this.selected[s]=n[s],this.selectOrder.push(s),this.fileDoms[s]&&this.fileDoms[s].div.addClass(this.options.selectedClass))}}function g(a,l,d){if(!a)throw new Error("Need a real object to put a viewer in");this.doms={},this.fileDoms={},this.shownFiles={},this.selected={},this.selectOrder=[],this.currentFiles={},this.currentOffset=0,this.showingCurrent=!1,this.options=e.extend({rememberSelection:!0,"class":"gHBrowser",cleanDiv:!1,selection:null,selectionClass:"select",selectedClass:"selected",orderedSelection:!1,orderClass:"orderer",exclusion:null,exclusionClass:"exclude",excludedClass:"excluded",limit:50,generators:{},defaultType:"image"},l),this.options.cleanDiv?a.append(this.doms.obj=e("<div></div>")):this.doms.obj=a,this.options.orderedSelection&&this.doms.obj.addClass("ordered"),this.options.class&&this.doms.obj.addClass(this.options.class);var r,c=Math.random().toString(36).substr(2,9),h=Math.random().toString(36).substr(2,9);if(this.doms.obj.append(e('<div class="tablenav"></div>').append('<label for="'+c+'">Images per page:</label>').append(this.doms.limit=e('<input type="number"  id="'+c+'">').change(t.bind(this))).append(r=e('<div class="drop">Select</div>').append(e("<ul></ul>").append(e("<li></li>").append(e("<a>all</a>").click(f.bind(this,1,!0))).append(" / ").append(e("<a>none</a>").click(f.bind(this,0,!0))).append(" on this page / ").append(e("<a>invert page selection</a>").click(f.bind(this,-1,!0)))).append(e("<li></li>").append(e("<a>all</a>").click(f.bind(this,1,!1))).append(" / ").append(e("<a>none</a>").click(f.bind(this,0,!1))).append(" / ").append(e("<a>invert</a>").click(f.bind(this,-1,!1)))))).append(e('<div class="drop">With selected</div>').append(actions=e("<ul></ul>"))).append(this.doms.showSelected=e("<span>Show selected</span>").click(p.bind(this,!1))).append(e("<span></span>").append(e('<input type="checkbox" id="'+h+'"'+(this.options.rememberSelection?" checked":"")+">").change(function(){this.options.rememberSelection=e(this).attr("checked")?!0:!1}.bind(this))).append('<label for="'+h+'">Remember selection</label>')).append(this.doms.pages=e('<span class="tablenav-pages"></span>'))).append(this.doms.pad=e('<div class="browser"></div>')),isNaN(this.options.limit)&&(this.options.limit=50),s.call(this,this.options.limit),actions.append(e("<li>Set exclusion</li>").click(o.bind(this,!0))),actions.append(e("<li>Unset exclusion</li>").click(o.bind(this,!1))),this.options.actions){var u;for(u in this.options.actions)actions.append(e("<li>"+u+"</li>").click(this.options.actions[u]))}this.doms.pages.append(this.doms.displaying=e('<span class="displaying-num"></span>')),this.doms.pages.append(this.doms.firstPage=e('<a class="first-page">&laquo;</a>').click(i.bind(this,null,1))),this.doms.pages.append(this.doms.prevPage=e('<a class="prev-page">&lsaquo;</a>').click(i.bind(this,-1,null))),this.doms.pages.append(this.doms.pageNumber=e('<input type="number" class="current-page" title="Current Page">').change(i.bind(this))).append(" of ").append(this.doms.totalPages=e('<span class="total-pages"></span>')),this.doms.pages.append(this.doms.nextPage=e('<a class="next-page">&rsaquo;</a>').click(i.bind(this,1))),this.doms.pages.append(this.doms.lastPage=e('<a class="last-page">&raquo;</a>').click(i.bind(this,null,-1))),this.options.insert&&this.doms.pad.addClass("builderOn"),d?(this.currentFiles=d,n.call(this,0)):this.doms.obj.hide()}return g.prototype={removeFile:function(){},displayFiles:function(e,t){this.doms.obj.show(),this.showingCurrent!==!1&&p.call(this,!0),t?(u.call(this,e),n.call(this,0)):(this.currentFiles=e,this.options.rememberSelection||(this.selected={},this.selectOrder=[]),n.call(this,0))}},g}(jQuery);e.viewer.option("gHBrowser",{generators:{imageEditor:h.bind(this)},scroll:!0,"default":"imageEditor"});var w={init:function(e){b=e,e.imageUrl&&(g=e.imageUrl),e.cacheUrl&&(v=e.cacheUrl)},scanControl:function(t,i){x.dom=t,t.append(x.status=e("<p></p>")),t.append(x.scanBtn=e('<a class="button">Rescan Directories</a>')),x.scanBtn.click(r.bind(this,"rescan",null)),t.append(" "),t.append(x.fullScanBtn=e('<a class="button">Force Rescan of All Images</a>')),x.fullScanBtn.click(r.bind(this,"full",null)),o(i)},uploader:function(t,i,s){t&&i&&(C[t]={options:s,obj:i,dir_id:!1,uploadedDiv:e("#"+t+"uploaded")},C[t].browser=new D(C[t].uploadedDiv,{limit:50,selection:!0,exclusion:f.bind(this,t),generators:{image:c.bind(this,t)}}),a(t))},setUploadDir:function(e,t){e&&C[e]&&(t.constructor===Array&&(t=t[0]),C[e].dirId=t.id,C[e].uploader.setOption("multipart_params",{dir_id:t.id}))},gallery:function(t,i){var s;(s=e("#"+t+"pad"))&&(y[t]={insertOnly:i,builderOn:i?!0:!1,pad:s,selected:{},currentImages:null,imageIndex:null,selectOrder:[],changed:{},currentOffset:0,currentLimit:0,showingCurrent:!1,idsOnly:!1,input:e("#"+t+"input"),form:e("#"+t+"form"),folders:[],foldersChanged:!1,recurse:e("#"+t+"recurse"),start:e("#"+t+"start"),end:e("#"+t+"end"),name:e("#"+t+"name"),title:e("#"+t+"title"),comment:e("#"+t+"comment"),tags:e("#"+t+"tags"),group:e("#"+t+"group"),"class":e("#"+t+"class"),limit:e("#"+t+"limit"),includeFilter:e("#"+t+"includeFilter"),includeExcluded:e("#"+t+"include_excluded"),sort:e("#"+t+"sort"),caption:e("#"+t+"caption"),"class":e("#"+t+"class"),popup_caption:e("#"+t+"popupCaption"),link:e("#"+t+"link"),size:e("#"+t+"size"),type:e("#"+t+"type"),options:{ghalbum:["type"],ghimage:["size"]},filter:e("#"+t+"filter"),filterButton:e("#"+t+"filterButton"),saveButton:e("#"+t+"saveButton"),filterLabel:e("#"+t+"filterLabel"),builder:e("#"+t+"builder"),builderLabel:e("#"+t+"builderLabel"),limit:e("#"+t+"limit"),shortcode:e("#"+t+"shortcode"),selectedLabel:e("#"+t+"selectedLabel"),sctype:e("#"+t+"sctype"),pages:e("#"+t+"pages")},isNaN(y[t].currentLimit=parseInt(y[t].limit.val()))&&(y[t].currentLimit=50,y[t].limit.val(50)),y[t].start.datetimepicker({timeFormat:"HH:mm",dateFormat:"yy-mm-dd",stepMinute:10,controlType:"select",onClose:function(){if(""!=y[t].end.val()){var e=y[t].start.datetimepicker("getDate"),i=y[t].end.datetimepicker("getDate");e>i&&y[t].end.datetimepicker("setDate",e)}},onSelect:function(){y[t].end.datetimepicker("option","minDate",y[t].start.datetimepicker("getDate"))}}),y[t].end.datetimepicker({timeFormat:"HH:mm",dateFormat:"yy-mm-dd",stepMinute:10,controlType:"select",onClose:function(){if(""!=y[t].start.val()){var e=y[t].start.datetimepicker("getDate"),i=y[t].end.datetimepicker("getDate");e>i&&y[t].start.datetimepicker("setDate",i)}},onSelect:function(){y[t].start.datetimepicker("option","maxDate",y[t].end.datetimepicker("getDate"))}}),y[t].sctype.change(w.redisplayShortcode.bind(this,t)),y[t]["class"].change(w.redisplayShortcode.bind(this,t)),y[t].group.change(w.redisplayShortcode.bind(this,t)),y[t].recurse.change(w.redisplayShortcode.bind(this,t)),y[t].start.change(w.redisplayShortcode.bind(this,t)),y[t].end.change(w.redisplayShortcode.bind(this,t)),y[t].name.change(w.redisplayShortcode.bind(this,t)),y[t].title.change(w.redisplayShortcode.bind(this,t)),y[t].comment.change(w.redisplayShortcode.bind(this,t)),y[t].tags.change(w.redisplayShortcode.bind(this,t)),y[t].includeFilter.change(w.redisplayShortcode.bind(this,t)),y[t].includeExcluded.change(w.redisplayShortcode.bind(this,t)),y[t].browser=new D(s,{selection:m.bind(this,t),orderedSelection:!0,exclusion:f.bind(this,t),limit:50,generators:{image:c.bind(this,t)}}),this.redisplayShortcode(t))},toggle:function(e,t,i,s,n){return y[e]?(s||(s="Show"),n||(n="Hide"),y[e]&&y[e][t]?y[e][t].hasClass(O)?(y[e][t].removeClass(O),y[e][t+"Label"].html(n+" "+i),!0):(y[e][t].addClass(O),y[e][t+"Label"].html(s+" "+i),!1):void 0):void 0},thumbnail:function(e){return v+"/"+e.replace(/\//g,"_")},full:function(e){return g+"/"+e},filter:function(t){if(y[t]){y[t].query||(y[t].query={folders:[],recurse:0,start:"",end:"",name:"",title:"",comment:"",tags:""});var i,s,n=!1;for(i in y[t].query)"folders"==i?y[t].foldersChanged&&(y[t].query[i]=y[t].folders,n=!0,y[t].foldersChanged=!1):"checkbox"==y[t][i].prop("type")?(s=y[t][i].prop("checked"),s&&!y[t].query[i]?(y[t].query[i]=1,n=!0):!s&&y[t].query[i]&&(y[t].query[i]=0,n=!0)):y[t].query[i]!=(s=y[t][i].val())&&(y[t].query[i]=s,n=!0);n&&(y[t].filterButton.html("Loading..."),e.post(ajaxurl+"?action=gh_gallery",y[t].query,this.receiveImages.bind(this,t)))}},toggleBuilder:function(e){y[e]&&(y[e].insertOnly?this.toggle(e,"builder","shortcode options"):(y[e].builderOn=this.toggle(e,"builder","shortcode builder","Enable","Disable"))?y[e].pad.addClass("builderOn"):y[e].pad.removeClass("builderOn"))},receiveImages:function(e,t){if(y[e]){if(t.error)return void alert(t.error);var i,s={};for(i in t)s[t[i].id]=t[i];y[e].filterButton.html("Filter"),y[e].browser.displayFiles(s),y[e].idsOnly=!1,this.redisplayShortcode(e)}},insert:function(e){if(y[e]){var t=this.gatherShortcodeData(e);0!==y[e].input.length&&(y[e].input.val(JSON.stringify(t)),y[e].form.submit())}},clearSelected:function(e){if(y[e]&&y[e].selectOrder){var t,i;if(y[e].showingCurrent===!1)for(t in y[e].selectOrder)i=y[e].selectOrder[t],y[e].imageIndex[i]&&(i=y[e].imageIndex[i],y[e].currentImages[i].div.removeClass("selected"));y[e].selectOrder=[],y[e].selected={},y[e].showingCurrent!==!1&&this.toggleSelected(e),y[e].idsOnly=!1,this.redisplayShortcode(e)}},order:function(e,t,i){if(y[e]&&(-1===i||1===i)&&y[e].currentImages[t]){var s=y[e].currentImages[t].id,n=y[e].selectOrder.indexOf(s);if(-1===i&&0===n||1===i&&n===y[e].selectOrder.length-1)return;var a=y[e].selectOrder[n+i];y[e].selectOrder[n+i]=y[e].selectOrder[n],y[e].selectOrder[n]=a,y[e].imageIndex[a]&&y[e].currentImages[y[e].imageIndex[a]]&&y[e].currentImages[y[e].imageIndex[a]].order.html(n+1),y[e].currentImages[t].order.html(n+i+1),this.redisplayShortcode(e)}},gatherShortcodeData:function(e){if(y[e]){var t={code:y[e].sctype.val()};if(y[e].selectOrder.length&&(t.ids=y[e].selectOrder),!y[e].idsOnly||y[e].includeFilter.attr("checked")){y[e].folders.length&&(t.folders=y[e].folders),t.start=y[e].start.val(),t.end=y[e].end.val();var i=["name","title","comment","tags"];for(p in i)(part=y[e][i[p]].val())&&(t[i[p]]=part)}y[e].includeExcluded.attr("checked")&&(t.include_excluded=1);var s,n=["class","group"];for(s in n)(part=y[e][n[s]].val())&&(t[n[s]]=part);return t}},changeFolder:function(e,t){if(y[e]){y[e].folders=[],y[e].foldersChanged=!0;var i;for(i in t)y[e].folders.push(t[i].id);w.redisplayShortcode(e)}},compileShortcode:function(e){if(y[e]){var t=this.gatherShortcodeData(e),i=[];if(t.ids&&(i=t.ids.slice(0)),!y[e].idsOnly||y[e].includeFilter.attr("checked")){t.folders&&i.push((y[e].recurse.attr("checked")?"r":"")+"folder="+t.folders.join("|"));var s=t.start,n=t.end;(s||n)&&i.push("taken="+(s?s:"")+"|"+(n?n:""));var a,l=["name","title","comment","tags"];for(p in l)(a=t[l[p]])&&i.push(l[p]+"="+a)}var d,r,o=[],c=["class","group","include_excluded"];for(r in c)(d=t[c[r]])&&o.push(c[r]+'="'+d+'"');return"["+t.code+(i.length?' id="'+i.join(",")+'"':"")+(o.length?" "+o.join(" "):"")+"]"}},redisplayShortcode:function(e){y[e]&&y[e].shortcode.html(this.compileShortcode(e))},save:function(t){if(y[t]){var i,s,n={},a=!1;for(i in y[t].changed)for(s in y[t].changed[i])y[t].changed[i][s]["new"]!==y[t].changed[i][s].old&&(n[i]||(n[i]={}),n[i][s]=y[t].changed[i][s]["new"],a=!0);a&&(y[t].saveButton.html("Saving..."),e.post(ajaxurl+"?action=gh_save",{a:"save",data:n},this.confirmSave.bind(this,t)))}},confirmSave:function(e,t){y[e]&&(t instanceof Object&&!t.error?(y[e].changed={},alert(t.msg)):alert(t.error),y[e].saveButton.html("Save Image Changes"),y[e].saveButton.addClass("disabled"))}};return w}(jQuery);