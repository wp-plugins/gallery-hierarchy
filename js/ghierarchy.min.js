var gH=function(){var e={},t=jQuery,a="hide";return{gallery:function(a,r,n,i){var l;(l=t("#"+a+"pad"))&&(e[a]={insertOnly:i,builderOn:i?!0:!1,imageUrl:r,cacheUrl:n,selected:{},currentImages:null,selectOrder:[],changed:{},currentOffset:0,currentLimit:0,showingCurrent:!1,idsOnly:!1,pad:l,folders:t("#"+a+"folders"),recurse:t("#"+a+"recurse"),start:t("#"+a+"start"),end:t("#"+a+"end"),name:t("#"+a+"name"),title:t("#"+a+"title"),comment:t("#"+a+"comment"),tags:t("#"+a+"tags"),filter:t("#"+a+"filter"),filterLabel:t("#"+a+"filterLabel"),builder:t("#"+a+"builder"),builderLabel:t("#"+a+"builderLabel"),limit:t("#"+a+"limit"),shortcode:t("#"+a+"shortcode"),selectedLabel:t("#"+a+"selectedLabel"),sctype:t("#"+a+"sctype"),pages:t("#"+a+"pages")},(e[a].currentLimit=parseInt(e[a].limit.val()))===!1&&(e[a].currentLimit=50,e[a].limit.val(50)),e[a].folders.multiselect({noneSelectedText:"Select folders",selectedText:"# folders selected"}),e[a].start.datetimepicker({timeFormat:"HH:mm",dateFormat:"yy-mm-dd",stepMinute:10,controlType:"select",onClose:function(){if(""!=e[a].end.val()){var t=e[a].start.datetimepicker("getDate"),r=e[a].end.datetimepicker("getDate");t>r&&e[a].end.datetimepicker("setDate",t)}},onSelect:function(){e[a].end.datetimepicker("option","minDate",e[a].start.datetimepicker("getDate"))}}),e[a].end.datetimepicker({timeFormat:"HH:mm",dateFormat:"yy-mm-dd",stepMinute:10,controlType:"select",onClose:function(){if(""!=e[a].start.val()){var t=e[a].start.datetimepicker("getDate"),r=e[a].end.datetimepicker("getDate");t>r&&e[a].start.datetimepicker("setDate",r)}},onSelect:function(){e[a].start.datetimepicker("option","maxDate",e[a].end.datetimepicker("getDate"))}})),this.compileShortcode(a)},toggle:function(t,r,n,i,l){return i||(i="Show"),l||(l="Hide"),e[t]&&e[t][r]?e[t][r].hasClass(a)?(e[t][r].removeClass(a),e[t][r+"Label"].html(l+" "+n),!0):(e[t][r].addClass(a),e[t][r+"Label"].html(i+" "+n),!1):void 0},thumbnail:function(e){return e.replace(/\//g,"_")},filter:function(a){e[a].query||(e[a].query={folders:[],recurse:!1,start:"",end:"",name:"",title:"",comment:"",tags:""});var r,n,i,l=!1;for(r in e[a].query)if("folders"==r){if(n=e[a][r].val(),null==e[a].query[r]&&null==n)continue;(null==e[a].query[r]||null==n||e[a].query[r].length!=n.length)&&(e[a].query[r]=n,l=!0);for(i in e[a].query[r])e[a].query[r][i]!=n[i]&&(e[a].query[r]=n,l=!0)}else"checkbox"==e[a][r].prop("type")?(n=e[a][r].prop("checked"),(e[a].query[r]?n:!n)&&(e[a].query[r]=n,l=!0)):e[a].query[r]!=(n=e[a][r].val())&&(e[a].query[r]=n,l=!0);l&&t.post(ajaxurl+"?action=gh_gallery",e[a].query,this.returnFunction(this.receiveData,a))},toggleBuilder:function(t){e[t].insertOnly?this.toggle(t,"builder","shortcode"):(e[t].builderOn=this.toggle(t,"builder","shortcode builder","Enable","Disable"))?e[t].pad.addClass("builderOn"):e[t].pad.removeClass("builderOn")},receiveData:function(t,a){e[t].imageData=a;var r;e[t].imageIndex={};for(r in e[t].imageData)e[t].imageIndex[e[t].imageData[r].id]=r;e[t].currentImages=e[t].imageData,this.printImages(t,0),e[t].idsOnly=!1,this.compileShortcode(t)},repage:function(t){var a=parseInt(e[t].limit.val());a===!1&&(e[t].limit.val("50"),a=50),e[t].currentOffset=a?Math.floor(e[t].currentOffset/a)*a:0,this.printImages(t,e[t].currentOffset)},changePage:function(t){var a,r=Math.floor(e[t].currentOffset/e[t].currentLimit)+1,n=Math.floor(e[t].currentImages.length/e[t].currentLimit)+1;(a=parseInt(e[t].pageNumber.val()))===!1?(a=r,e[t].pageNumber.val(a)):a>n?(a=n,e[t].pageNumber.val(a)):1>a&&(a=1,e[t].pageNumber.val(a)),a!=r&&(a=(a-1)*e[t].currentLimit,this.printImages(t,a))},printImages:function(a,r){(r=parseInt(r))===!1&&(r=0),console.log("New offset is "+r),e[a].currentOffset=r,e[a].pad.html("");var n=Math.min(r+e[a].currentLimit,e[a].currentImages.length);r=Math.min(r,e[a].currentImages.length);var i;for(i=r;n>i;i++){var l,s,d=(e[a].currentImages[i].div=t(document.createElement("div"))).addClass("galleryThumb");d.append(l=t(document.createElement("img"))),l.attr("src",e[a].cacheUrl+"/"+this.thumbnail(e[a].currentImages[i].file)),d.append(l=t(document.createElement("div"))),l.click(this.returnFunction(this.exclude,a,i)),l.addClass("exclude"),l.attr("title","Exclude from galleries by default"),d.append(l=t(document.createElement("div"))),l.addClass("select"),l.click(this.returnFunction(this.select,a,i)),l.attr("title","Include in selection"),d.append(l=t(document.createElement("div"))),l.addClass("orderer"),l.append(s=t(document.createElement("div"))),s.addClass("dashicons dashicons-arrow-left-alt"),s.click(this.returnFunction(this.order,a,i,-1)),l.append(e[a].currentImages[i].order=s=t(document.createElement("div"))),s.addClass("order"),l.append(s=t(document.createElement("div"))),s.addClass("dashicons dashicons-arrow-right-alt"),s.click(this.returnFunction(this.order,a,i,1)),!e[a].currentImages[i].exclude||"1"!==e[a].currentImages[i].exclude&&e[a].currentImages[i].exclude!==!0||d.addClass("excluded"),e[a].selected[e[a].currentImages[i].id]&&(d.addClass("selected"),e[a].currentImages[i].order.html(e[a].selectOrder.indexOf(e[a].currentImages[i].id)+1)),e[a].pad.append(d)}e[a].pages.html(""),e[a].pages.append(l=t(document.createElement("span"))),l.addClass("displaying-num"),l.html(e[a].currentImages.length+" items"),e[a].pages.append(l=t(document.createElement("a"))),0!==r?l.click(this.returnFunction(this.printImages,a,0)):l.addClass("disabled"),l.html("&laquo;"),l.addClass("first-page"),e[a].pages.append(l=t(document.createElement("a"))),0!==r?((i=r-n)<0&&(i=0),l.click(this.returnFunction(this.printImages,a,i))):l.addClass("disabled"),l.html("&lsaquo;"),l.addClass("prev-page"),e[a].pages.append(l=e[a].pageNumber=t(document.createElement("input"))),l.attr("type","number"),l.addClass("current-page"),l.attr("title","Current Page"),l.val(Math.ceil(r/e[a].currentLimit)+1),l.change(this.returnFunction(this.changePage,a)),e[a].pages.append(document.createTextNode(" of "));var c=Math.floor(e[a].currentImages.length/e[a].currentLimit),o=c*e[a].currentLimit;e[a].pages.append(l=t(document.createElement("span"))),l.addClass("total-pages"),l.html(c+1),e[a].pages.append(l=t(document.createElement("a"))),r!==o?((i=r+e[a].currentLimit)>o&&(i=o),l.click(this.returnFunction(this.printImages,a,i))):l.addClass("disabled"),l.html("&rsaquo;"),l.addClass("next-page"),e[a].pages.append(l=t(document.createElement("a"))),r!==o?l.click(this.returnFunction(this.printImages,a,o)):l.addClass("disabled"),l.html("&raquo;"),l.addClass("last-page")},toggleSelected:function(t){if(e[t].showingCurrent!==!1)e[t].currentImages=e[t].imageData,e[t].selectedLabel.html("Show currently selected images"),this.printImages(t,e[t].showingCurrent),e[t].showingCurrent=!1;else{e[t].currentImages=[];var a;for(a in e[t].selectOrder)e[t].currentImages[a]=e[t].selected[e[t].selectOrder[a]];e[t].showingCurrent=e[t].currentOffset,e[t].currentOffset=0,e[t].selectedLabel.html("Show filtered images"),this.printImages(t,e[t].showingCurrent)}},returnFunction:function(e){var t=Array.prototype.slice.call(arguments);t.shift();var a=this;return function(){t=t.concat(Array.prototype.slice.call(arguments)),e.apply(a,t)}},order:function(t,a,r){if((-1===r||1===r)&&e[t].imageData[a]){var n=e[t].imageData[a].id,i=e[t].selectOrder.indexOf(n);if(-1===r&&0===i||1===r&&i===e[t].selectOrder.length-1)return;var l=e[t].selectOrder[i+r];e[t].selectOrder[i+r]=e[t].selectOrder[i],e[t].selectOrder[i]=l,e[t].imageData[e[t].imageIndex[l]]&&e[t].imageData[e[t].imageIndex[l]].order.html(i+1),e[t].imageData[a].order.html(i+r+1),this.compileShortcode(t)}},compileShortcode:function(t){var a="["+e[t].sctype.val(),r=[];if(e[t].selectOrder.length&&(r=e[t].selectOrder.slice(0)),!e[t].idsOnly){var n=e[t].folders.val();n&&r.push("folder="+n.join("|"));var i=e[t].start.val(),l=e[t].end.val();(i||l)&&r.push("taken="+(i?i:"")+"|"+(l?l:""));var s,d=["name","title","comment","tags"];for(p in d)(s=e[t][d[p]].val())&&r.push(d[p]+"="+s)}a+=' id="'+r.join(",")+'"',a+="]",e[t].shortcode.html(a)},save:function(a){var r,n,i={},l=!1;for(r in e[a].changed){console.log("Change "+r);for(n in e[a].changed[r])console.log("Change value "+n),e[a].changed[r][n]["new"]!==e[a].changed[r][n].old&&(i[r]||(console.log("Setting new value "+e[a].changed[r][n]["new"]),i[r]={}),i[r][n]=e[a].changed[r][n]["new"],l=!0)}l&&t.post(ajaxurl+"?action=gh_save",{saveData:i},this.returnFunction(this.confirmSave,a))},confirmSave:function(t,a){alert(a),"Error"!==a.substring(0,"Error".length)&&(e[t].changed={})},select:function(t,a){if(e[t].imageData[a]){var r,n=e[t].imageData[a].id;e[t].selected[n]?(-1!==(r=e[t].selectOrder.indexOf(n))&&e[t].selectOrder.splice(r,1),e[t].imageData[a].div.removeClass("selected"),e[t].selected[n].selected=!1):(e[t].selected[n]=e[t].imageData[a],e[t].selected[n].selected=!0,e[t].selectOrder.push(n),e[t].imageData[a].order.html(e[t].selectOrder.length),e[t].imageData[a].div.addClass("selected"),e[t].idsOnly=!0),this.compileShortcode(t)}},exclude:function(t,a){if(e[t].imageData[a]){var r=e[t].imageData[a].id;e[t].changed[r]||(e[t].changed[r]={}),e[t].changed[r].exclude||(e[t].changed[r].exclude={old:e[t].imageData[a].exclude}),e[t].changed[r].exclude["new"]?(e[t].changed[r].exclude["new"]=!1,e[t].imageData[a].div.removeClass("excluded")):(e[t].changed[r].exclude["new"]=!0,e[t].imageData[a].div.addClass("excluded"))}}}}();
